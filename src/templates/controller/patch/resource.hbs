import { Logger } from '@agrippa-io/node-utils/src'
import * as mongoose from '@agrippa-io/node-mongoose/src'
import { ExpressRequestMongooseUtil, UseCaseExecutor } from '@agrippa-io/node-mongoose/src/utils'
import express from 'express'
import MODEL from '../../constants/models'
import Interface{{ pascalCase model }}Doc from '../../models/{{ pascalCase model }}/interfaces/document'
import Mongoose{{ pascalCase model }}PatchOne from '../../usecases/{{ pascalCase model }}/MongoosePatchOne'

export default async (request: express.Request, response: express.Response) => {
  Logger.route('PATCH /v3/{{ snakeCase model }}s/:id')
  const {
    params: { id },
  } = request

  const queryBuilder: ExpressRequestMongooseUtil<Interface{{ pascalCase model }}Doc> =
    new ExpressRequestMongooseUtil<Interface{{ pascalCase model }}Doc>(request)

  const filterQuery: mongoose.FilterQuery<Interface{{ pascalCase model }}Doc> = { _id: id }
  const updateQuery: mongoose.UpdateQuery<Interface{{ pascalCase model }}Doc> = queryBuilder.bodyUpdateQuery()

  const patch{{ pascalCase model }}: Mongoose{{ pascalCase model }}PatchOne = new Mongoose{{ pascalCase model }}PatchOne({
    options: {},
    filterQuery,
    updateQuery,
  })

  await patch{{ pascalCase model }}.perform()

  await UseCaseExecutor.renderUseCase(patch{{ pascalCase model }}, request, response, {
    rootModel: MODEL.{{ constantCase model }},
  })
}
